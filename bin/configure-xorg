#!/bin/bash

set -x
logger "configure-xorg started"


xinput set-prop "PS/2 Generic Mouse" "Evdev Middle Button Emulation" "1"
xinput set-prop "PS/2 Generic Mouse" "Evdev Wheel Emulation" "1"
xinput set-prop "PS/2 Generic Mouse" "Evdev Wheel Emulation Button" "3"

xinput set-prop "SynPS/2 Synaptics TouchPad" "Synaptics Edge Scrolling" 1 1 0
xinput set-prop "SynPS/2 Synaptics TouchPad" "Synaptics Edges" 0 0 0 4282
xinput set-prop "SynPS/2 Synaptics TouchPad" "Synaptics Scrolling Distance" 100 100
xinput set-prop "SynPS/2 Synaptics TouchPad" "Synaptics Tap Time" 0

xinput set-prop "PixArt Microsoft USB Optical Mouse" "Device Accel Velocity Scaling" 3

exit

function match_prop {
    PROP=$(xinput --list-props $ID | grep "$1" | ruby -n -e '$_.match /(\d+)/; puts $1')
}
    

logger "disable touchpad"
ID=$(xinput | grep TouchPad | ruby -n -e '$_.match /id=(\d+)/; puts $1')
xinput disable $ID

logger "enable middle mouse emulation"
ID=$(xinput | grep Generic\ Mouse | ruby -n -e '$_.match /id=(\d+)/; puts $1')
MATCH="Evdev Middle Button Emulation"
match_prop "$MATCH"
if ! [ -x "$PROP" ]; then
    MATCH="Middle Emulation Enabled ("
    match_prop "$MATCH"
fi
xinput --set-prop $ID $PROP 1


logger "enable wheel emulation"
PROP=$(xinput --list-props $ID | grep 'Evdev Wheel Emulation' | head -1 | ruby -n -e '$_.match /(\d+)/; puts $1')
xinput --set-prop $ID $PROP 1

logger 'set wheel emulation button to middle (3)'
PROP=$(xinput --list-props $ID | grep 'Evdev Wheel Emulation Button' | ruby -n -e '$_.match /(\d+)/; puts $1')
xinput --set-prop $ID $PROP 3

logger 'set the workstation mouse to accelerate slowly'

ID=$(xinput | grep PixArt\ Microsoft\ USB\ Optical\ Mouse | ruby -n -e '$_.match /id=(\d+)/; puts $1')
PROP=$(xinput --list-props $ID | grep 'Device Accel Velocity Scaling' | ruby -n -e '$_.match /(\d+)/; puts $1')
xinput --set-prop $ID $PROP 2


#xmodmap -e "keycode 115 = End"
#xmodmap -e "keycode 110 = Home"
#xset m 20/8 2
#logger "configure-xorg finished"
#xinput --set-prop $ID "Device Accel Constant Deceleration" .65
#synclient TouchpadOff=1
